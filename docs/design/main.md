# GisL 设计思路

GisL 是一个 GIS 桌面软件，设计思路模仿 [QGIS](https://github.com/qgis/QGIS)，是
GIS 编程的一种实践。

## 技术选型

- [x] 整体设计和细节实现全部依照 QGIS
- [x] 界面使用 Qt
- [x] 底层地理数据读写使用 GDAL/OGR
- [x] 矢量图形绘制使用 OpenGL 和 QPainter
- [x] 部分地图绘制使用 GMT
- [x] 图表绘制使用 QWT
- [x] 计算机视觉部分使用 OpenCV
- [x] 文档生成使用 Doxygen 和 Sphinx
- [x] C++ 底层使用 absl
- [x] 单元测试使用 Catch2
- [x] 矩阵库使用 Eigen

## 整体架构

- 主程序分为 4 个模块，分别是 `core`(包括 `gui`), `ui`, `codecvt`, `utils`,
  `analysis`
- `core` 模块包含 `geometry`, `provider`, `layer`, `vector`, `raster`
- `gui` 模块包括 `gui`, `command`, `render`, `painter`, `symbolizer`
- GUI 和 CLI 均支持，程序可以在脱离 GUI 情况下运行
- `codecvt` 模块能实现读写自定义二进制数据
- `utils` 模块包括一些可复用工具
- `analysis` 模块包括一些栅格分析算法

## 软件特色

快，读写要快，运行要快，计算要快，可视化要快。一切面向用户的功能都要快到极致。

### 优点

1. 语言。使用c++作为开发语言，天生就比解释型语言要快，比如python，matlab。
2. 多线程。ui与后台线程分离，让用户察觉不到界面卡顿。再加上执行多任务时自动跑满计算机最大线程，应对海量地理数据更加高效。
3. GPU加速。gpu不仅仅在渲染阶段使用，还在计算环节大显身手。同时使用内存和显存存储数据，牺牲少部分空间换取时间，让计算与显示同时进行。
4. smid。在处理栅格数据时，最大化利用cpu光栅，从而使得矩阵计算具有并行效果。
5. 虚函数。虚函数非常影像c++性能，但在gis中，矢量数据往往需要继承与派生。于是我们才去一种中和手段，将读与处理分离，牺牲读性能换取更强大的处理计算性能。
6. 算法。普通gis算法并未对速度进行优化，例如ndvi指数，多半是直接循环，但这里使用分块多线程计算。再如遥感影像对比度增强，使用双指针做到时间复杂度最大o(m*n)(矩阵大小)，空间复杂度为常数。
7. 编译期加速。使用模板元编程手段，智能管理指针与线程库，加长了编译器时间却大大加快了运行速度。

### 缺点

1. 不利于学习。源码使用了太多c++语言特性，同时使用了太多c++编程技巧，还使用了众多指针，使得阅读源码难度稍高。
2. 环境复杂。由于过于追求运行速度，使得软件配置复杂，在win上理论上可以编译，但因过多依赖暂未编译成功。
3. 编译时间长。将太多运行时放到了编译期，使得编译一次花费数分钟。
4. 内存消耗大。此处仅针对软件自身对比，若是按需加载内存便消耗少。但即便如此，相比同样功能java，python程序还是内存低不少。

总之，该软件并非是面向大众的软件，而是个人炫技用软件，为探索gis开发的一种实践。本软件未使用任何gis引擎，核心算法均由自己实现。
